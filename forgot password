to@{
    ViewBag.Title = "Forgot Password";
    Layout = "~/Views/Shared/_Layout.cshtml";   // remove if not using layout
}
<h2 class="text-center mt-3">Reset Your Password</h2>
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-5">
            @if (TempData["success"] != null)
            {
                <div class="alert alert-success">@TempData["success"]</div>
            }
            @if (TempData["error"] != null)
            {
                <div class="alert alert-danger">@TempData["error"]</div>
            }
            <form method="post" action="/Account/ForgotPassword">
                <!-- Email -->
                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" name="Email" class="form-control" required />
                </div>
                <!-- New Password -->
                <div class="mb-3">
                    <label class="form-label">New Password</label>
                    <input type="password" name="NewPassword" class="form-control" required />
                </div>
                <!-- Confirm Password -->
                <div class="mb-3">
                    <label class="form-label">Confirm New Password</label>
                    <input type="password" name="ConfirmPassword" class="form-control" required />
                </div>
                <button class="btn btn-primary w-100 mt-3">Reset Password</button>
                <div class="text-center mt-3">
                    <a href="/Account/Login">Back to Login</a>
                </div>
            </form>
        </div>
    </div>
</div>


---------------------------------------------Account controller


[HttpPost]
        public ActionResult ForgotPassword(string email, string newPassword, string confirmPassword)
        {
            if (newPassword != confirmPassword)
            {
                TempData["error"] = "Password mismatch!";
                return View();
            }

            try
            {
                using (SqlConnection con = new SqlConnection(connString))
                {
                    string query = "UPDATE Users SET PasswordHash=@PasswordHash WHERE Email=@Email";
                    SqlCommand cmd = new SqlCommand(query, con);
                    cmd.Parameters.AddWithValue("@PasswordHash", newPassword); // Plain password
                    cmd.Parameters.AddWithValue("@Email", email);
                    con.Open();
                    int rows = cmd.ExecuteNonQuery();
                    if (rows == 1)
                    {
                        TempData["success"] = "Password Updated Successfully!";
                        return RedirectToAction("Login");
                    }
                    else
                    {
                        TempData["error"] = "Email not found!";
                        return View();
                    }
                }
            }
            catch (Exception ex)
            {
                TempData["error"] = "Error updating password: " + ex.Message;
                return View();
            }
        }










updated one



[HttpPost]
public ActionResult SendOTP(string Email)
{
    string otp = new Random().Next(100000, 999999).ToString();

    using (SqlConnection con = new SqlConnection(connString))
    {
        SqlCommand cmd = new SqlCommand("SP_ForgotPassword", con);
        cmd.CommandType = CommandType.StoredProcedure;
        cmd.Parameters.AddWithValue("@Mode", "CheckEmail");
        cmd.Parameters.AddWithValue("@Email", Email);

        con.Open();
        int count = Convert.ToInt32(cmd.ExecuteScalar());

        if (count == 0)
        {
            TempData["error"] = "Email not found!";
            return View("ForgotPassword");
        }
    }

    // Save OTP
    using (SqlConnection con = new SqlConnection(connString))
    {
        SqlCommand cmd = new SqlCommand("SP_ForgotPassword", con);
        cmd.CommandType = CommandType.StoredProcedure;
        cmd.Parameters.AddWithValue("@Mode", "InsertOTP");
        cmd.Parameters.AddWithValue("@Email", Email);
        cmd.Parameters.AddWithValue("@OTP", otp);

        con.Open();
        cmd.ExecuteNonQuery();
    }

    // Send email (dummy for now)
    TempData["success"] = $"OTP Sent to {Email} (OTP: {otp})";

    ViewBag.Email = Email;
    return View("VerifyOTP");
}






[HttpPost]
public ActionResult VerifyOTP(string Email, string OTP)
{
    using (SqlConnection con = new SqlConnection(connString))
    {
        SqlCommand cmd = new SqlCommand("SP_ForgotPassword", con);
        cmd.CommandType = CommandType.StoredProcedure;

        cmd.Parameters.AddWithValue("@Mode", "VerifyOTP");
        cmd.Parameters.AddWithValue("@Email", Email);
        cmd.Parameters.AddWithValue("@OTP", OTP);

        con.Open();
        int valid = Convert.ToInt32(cmd.ExecuteScalar());

        if (valid == 1)
        {
            TempData["success"] = "OTP Verified!";
            ViewBag.Email = Email;
            return View("ResetPassword");
        }
        else
        {
            TempData["error"] = "Invalid OTP!";
            ViewBag.Email = Email;
            return View("VerifyOTP");
        }
    }
}



[HttpPost]
public ActionResult ResetPassword(string Email, string NewPassword, string ConfirmPassword)
{
    if (NewPassword != ConfirmPassword)
    {
        TempData["error"] = "Password mismatch!";
        return View();
    }

    using (SqlConnection con = new SqlConnection(connString))
    {
        SqlCommand cmd = new SqlCommand("SP_ForgotPassword", con);
        cmd.CommandType = CommandType.StoredProcedure;

        cmd.Parameters.AddWithValue("@Mode", "UpdatePassword");
        cmd.Parameters.AddWithValue("@Email", Email);
        cmd.Parameters.AddWithValue("@NewPassword", NewPassword);

        con.Open();
        cmd.ExecuteNonQuery();
    }

    TempData["success"] = "Password Updated Successfully!";
    return RedirectToAction("Login");
}












[HttpGet]
public ActionResult VerifyOTP(string Email)
{
    ViewBag.Email = Email;
    return View();
}

[HttpGet]
public ActionResult ResetPassword(string Email)
{
    ViewBag.Email = Email;
    return View();
}






// ===================== FORGOT PASSWORD ======================
[HttpGet]
public ActionResult ForgotPassword()
{
    return View();
}

[HttpPost]
public ActionResult SendOTP(string Email)
{
    string otp = new Random().Next(100000, 999999).ToString();

    // STEP 1: CHECK EMAIL EXISTS
    using (SqlConnection con = new SqlConnection(connString))
    {
        SqlCommand cmd = new SqlCommand("SP_ForgotPassword", con);
        cmd.CommandType = CommandType.StoredProcedure;
        cmd.Parameters.AddWithValue("@Mode", "CheckEmail");
        cmd.Parameters.AddWithValue("@Email", Email);

        con.Open();
        int count = Convert.ToInt32(cmd.ExecuteScalar());

        if (count == 0)
        {
            TempData["error"] = "Email not found!";
            return View("ForgotPassword");
        }
    }

    // STEP 2: SAVE OTP
    using (SqlConnection con = new SqlConnection(connString))
    {
        SqlCommand cmd = new SqlCommand("SP_ForgotPassword", con);
        cmd.CommandType = CommandType.StoredProcedure;
        cmd.Parameters.AddWithValue("@Mode", "InsertOTP");
        cmd.Parameters.AddWithValue("@Email", Email);
        cmd.Parameters.AddWithValue("@OTP", otp);

        con.Open();
        cmd.ExecuteNonQuery();
    }

    // STEP 3: DUMMY EMAIL SENDING
    TempData["success"] = $"OTP Sent to {Email} (OTP: {otp})";

    ViewBag.Email = Email;
    return View("VerifyOTP");
}






[HttpPost]
public ActionResult VerifyOTP(string Email, string OTP)
{
    using (SqlConnection con = new SqlConnection(connString))
    {
        SqlCommand cmd = new SqlCommand("SP_ForgotPassword", con);
        cmd.CommandType = CommandType.StoredProcedure;

        cmd.Parameters.AddWithValue("@Mode", "VerifyOTP");
        cmd.Parameters.AddWithValue("@Email", Email);
        cmd.Parameters.AddWithValue("@OTP", OTP);

        con.Open();
        int valid = Convert.ToInt32(cmd.ExecuteScalar());

        if (valid == 1)
        {
            TempData["success"] = "OTP Verified!";
            ViewBag.Email = Email;
            return View("ResetPassword");
        }
        else
        {
            TempData["error"] = "Invalid OTP!";
            ViewBag.Email = Email;
            return View("VerifyOTP");
        }
    }
}






[HttpPost]
public ActionResult ResetPassword(string Email, string NewPassword, string ConfirmPassword)
{
    if (NewPassword != ConfirmPassword)
    {
        TempData["error"] = "Password mismatch!";
        ViewBag.Email = Email;
        return View();
    }

    using (SqlConnection con = new SqlConnection(connString))
    {
        SqlCommand cmd = new SqlCommand("SP_ForgotPassword", con);
        cmd.CommandType = CommandType.StoredProcedure;

        cmd.Parameters.AddWithValue("@Mode", "UpdatePassword");
        cmd.Parameters.AddWithValue("@Email", Email);
        cmd.Parameters.AddWithValue("@NewPassword", NewPassword);

        con.Open();
        cmd.ExecuteNonQuery();
    }

    TempData["success"] = "Password Updated Successfully!";
    return RedirectToAction("Login");
}
