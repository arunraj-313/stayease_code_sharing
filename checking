<div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <h2 class="popup-title">Login</h2>

            <form id="ajaxLoginForm">

                <div class="form-group">
                    <label class="popup-label">Email or Username</label>
                    <input type="text" name="email" class="popup-input" placeholder="Enter your email" />
                    <span id="emailError" class="text-danger" style="font-size:13px;"></span>
                </div>

                <div class="form-group">
                    <label class="popup-label">Password</label>
                    <input type="password" name="password" class="popup-input" placeholder="Enter your password" />
                    <span id="passwordError" class="text-danger" style="font-size:13px;"></span>
                </div>

                <span id="loginError" class="text-danger" style="font-size:14px; display:block; text-align:center; margin-top:5px;"></span>

                <button type="submit" class="popup-btn">Login</button>

                <div class="popup-links text-center mt-3">
                    <a href="/Account/ForgotPassword">Forgot Password?</a><br />
                    <a href="/Account/Register">New User? Register Here</a>
                </div>

            </form>
        </div>
    </div>
</div>



.modal-content {
    background: #0c1733;
    padding: 30px;
    border-radius: 16px;
    border: 1px solid rgba(245,210,106,0.4);
    box-shadow: 0 0 25px rgba(0,0,0,0.6);
    color: white;
}

.popup-title {
    text-align: center;
    color: #f5d26a;
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 20px;
}

.popup-label {
    color: #f5d26a;
    font-weight: 600;
}

.popup-input {
    width: 100%;
    padding: 12px;
    border-radius: 12px;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.15);
    color: white;
}

.popup-input:focus {
    border-color: #f5d26a;
    box-shadow: 0 0 8px rgba(245,210,106,0.5);
}

.popup-btn {
    width: 100%;
    background: #f5d26a;
    color: #071028;
    border: none;
    padding: 12px;
    border-radius: 12px;
    font-weight: 700;
    margin-top: 10px;
}

.popup-btn:hover {
    background: #ffe8a4;
}

.text-danger {
    color: #ff6b6b !important;
}




<script>
$("#ajaxLoginForm").submit(function (e) {
    e.preventDefault();

    $("#emailError").text("");
    $("#passwordError").text("");
    $("#loginError").text("");

    $.ajax({
        url: "/Account/AjaxLogin",
        type: "POST",
        data: {
            email: $("input[name='email']").val(),
            password: $("input[name='password']").val()
        },
        success: function (res) {

            if (!res.success) {

                if (res.field === "email") {
                    $("#emailError").text(res.message);
                }
                else if (res.field === "password") {
                    $("#passwordError").text(res.message);
                }
                else {
                    $("#loginError").text(res.message);
                }

                $("#loginModal").modal("show");
                return;
            }

            window.location.href = res.redirect;
        }
    });
});
</script>







[HttpPost]
public JsonResult AjaxLogin(string email, string password)
{
    if (string.IsNullOrEmpty(email))
    {
        return Json(new { success = false, field = "email", message = "Enter email or username" });
    }

    if (string.IsNullOrEmpty(password))
    {
        return Json(new { success = false, field = "password", message = "Enter password" });
    }

    string identifier = email.Trim().ToLower();
    string pass = password.Trim();

    using (SqlConnection con = new SqlConnection(connString))
    {
        con.Open();

        // 1) SuperAdmin
        using (SqlCommand cmd = new SqlCommand("SELECT COUNT(*) FROM SuperAdmin WHERE LOWER(Username)=@Id AND PasswordHash=@P", con))
        {
            cmd.Parameters.AddWithValue("@Id", identifier);
            cmd.Parameters.AddWithValue("@P", pass);

            if ((int)cmd.ExecuteScalar() == 1)
            {
                Session["SuperAdmin"] = identifier;
                return Json(new { success = true, redirect = Url.Action("Dashboard", "SuperAdmin") });
            }
        }

        // 2) Admin
        using (SqlCommand cmd = new SqlCommand("SELECT AdminID, FullName FROM Admins WHERE (LOWER(Email)=@Id OR LOWER(FullName)=@Id) AND PasswordHash=@P", con))
        {
            cmd.Parameters.AddWithValue("@Id", identifier);
            cmd.Parameters.AddWithValue("@P", pass);

            using (SqlDataReader dr = cmd.ExecuteReader())
            {
                if (dr.Read())
                {
                    Session["UserID"] = dr["AdminID"].ToString();
                    Session["FullName"] = dr["FullName"].ToString();
                    Session["Role"] = "Admin";

                    return Json(new { success = true, redirect = Url.Action("Dashboard", "Admin") });
                }
            }
        }

        // 3) User
        using (SqlCommand cmd = new SqlCommand("SELECT UserID, FullName FROM Users WHERE (LOWER(Email)=@Id OR LOWER(FullName)=@Id) AND PasswordHash=@P", con))
        {
            cmd.Parameters.AddWithValue("@Id", identifier);
            cmd.Parameters.AddWithValue("@P", pass);

            using (SqlDataReader dr = cmd.ExecuteReader())
            {
                if (dr.Read())
                {
                    Session["UserID"] = dr["UserID"].ToString();
                    Session["FullName"] = dr["FullName"].ToString();
                    Session["Role"] = "User";

                    return Json(new { success = true, redirect = Url.Action("Index", "Home") });
                }
            }
        }
    }

    // If invalid login
    return Json(new { success = false, field = "login", message = "Invalid email/username or password!" });
}



@model StayEasePG.Models.UserModel
@{
    ViewBag.Title = "Register";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    body {
        background: linear-gradient(135deg, #071028, #0b1c3f);
        color: white;
    }

    .page-center {
        min-height: 90vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .reg-card {
        background: rgba(255, 255, 255, 0.06);
        padding: 35px;
        width: 650px;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow: 0 0 20px rgba(0,0,0,0.45);
        transition: 0.25s ease;
    }

    .reg-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 0 22px rgba(245, 210, 106, 0.35);
        border-color: #f5d26a;
    }

    .reg-title {
        text-align: center;
        color: #f5d26a;
        font-size: 30px;
        font-weight: 700;
        margin-bottom: 25px;
    }

    .form-label {
        color: #f5d26a;
        font-weight: 600;
        margin-bottom: 6px;
    }

    .form-control, select {
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: white !important;
        border-radius: 10px;
        padding: 10px;
        height: 45px;
    }

    .form-control:focus {
        border-color: #f5d26a;
        background: rgba(255, 255, 255, 0.15);
        box-shadow: 0 0 8px rgba(245, 210, 106, 0.5);
    }

    .btn-register {
        background: #f5d26a;
        color: #071028;
        border: none;
        padding: 12px;
        width: 100%;
        font-weight: 700;
        border-radius: 10px;
        margin-top: 15px;
        transition: .25s;
    }

    .btn-register:hover {
        background: #ffe8a4;
        box-shadow: 0 0 12px rgba(245, 210, 106, 0.6);
    }

    .login-link {
        text-align: center;
        display: block;
        margin-top: 15px;
        color: #f5d26a;
        font-weight: 600;
        text-decoration: none;
    }

    .login-link:hover {
        color: white;
        text-decoration: underline;
    }
</style>

<div class="page-center">
    <div class="reg-card">

        <h3 class="reg-title">Create Your StayEase Account</h3>

        @if (TempData["success"] != null)
        {
            <div class="alert alert-success">@TempData["success"]</div>
        }

        @if (TempData["error"] != null)
        {
            <div class="alert alert-danger">@TempData["error"]</div>
        }

        @using (Html.BeginForm("Register", "Account", FormMethod.Post))
        {
            <div class="row">

                <div class="col-md-6 mb-3">
                    <label class="form-label">Full Name</label>
                    @Html.TextBoxFor(m => m.FullName, new { @class = "form-control", required = "required" })
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Email</label>
                    @Html.TextBoxFor(m => m.Email, new { @class = "form-control", type = "email", required = "required" })
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Gender</label>
                    @Html.DropDownListFor(m => m.Gender,
                        new SelectList(new[] { "Male", "Female", "Others" }),
                        "Select Gender",
                        new { @class = "form-control", required = "required" })
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Phone Number</label>
                    @Html.TextBoxFor(m => m.PhoneNo, new { @class = "form-control", required = "required" })
                </div>

                <div class="col-md-12 mb-3">
                    <label class="form-label">Address</label>
                    @Html.TextAreaFor(m => m.Address, new { @class = "form-control", rows = "2", required = "required" })
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">ID Proof Type</label>
                    @Html.DropDownListFor(m => m.IDProofType,
                        new SelectList(new[] { "Aadhar", "PAN", "Voter ID" }),
                        "Select ID Proof",
                        new { @class = "form-control", required = "required" })
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">ID Proof Number</label>
                    @Html.TextBoxFor(m => m.IDProofNumber, new { @class = "form-control", required = "required" })
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Occupation</label>
                    @Html.TextBoxFor(m => m.Occupation, new { @class = "form-control", required = "required" })
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Role</label>
                    @Html.DropDownListFor(m => m.Role,
                        new SelectList(new[] { "User", "Admin" }),
                        "Select Role",
                        new { @class = "form-control", required = "required" })
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Password</label>
                    @Html.PasswordFor(m => m.Password, new { @class = "form-control", required = "required" })
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Confirm Password</label>
                    @Html.PasswordFor(m => m.ConfirmPassword, new { @class = "form-control", required = "required" })
                </div>

            </div>

            <button type="submit" class="btn-register">Register</button>

            <a href="/Account/Login" class="login-link">Already have an account? Login</a>
        }
    </div>
</div>










using StayEasePG.Models;
using System;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Data.SqlClient;
using System.Linq;
using System.Web;
using System.Net.Mail;
using System.Web.Mvc;
using System.Net;

namespace StayEasePG.Controllers
{
    public class AccountController : Controller
    {
        // DB Connection
        string connString = ConfigurationManager.ConnectionStrings["StayEasePGConn"].ConnectionString;



        // ===================== REGISTER ======================
        [HttpGet]
        public ActionResult Register()
        {
            return View(new UserModel());
        }


        [HttpPost]
        public ActionResult Register(UserModel user)
        {
            try
            {
                // 1. Check email exist or not
                using (SqlConnection con = new SqlConnection(connString))
                {
                    con.Open();
                    SqlCommand checkCmd = new SqlCommand("SELECT COUNT(*) FROM Users WHERE Email=@Email", con);
                    checkCmd.Parameters.AddWithValue("@Email", user.Email);

                    int count = (int)checkCmd.ExecuteScalar();
                    if (count > 0)
                    {
                        TempData["error"] = "Email already exists!";
                        return View(user);
                    }
                }

                // 2. Generate OTP
                Random rnd = new Random();
                int otp = rnd.Next(100000, 999999);

                // 3. Save User Details temporarily in Session
                Session["Reg_FullName"] = user.FullName;
                Session["Reg_Email"] = user.Email;
                Session["Reg_Password"] = user.Password;
                Session["Reg_Gender"] = user.Gender;
                Session["Reg_PhoneNo"] = user.PhoneNo;
                Session["Reg_Address"] = user.Address;
                Session["Reg_IDProofType"] = user.IDProofType;
                Session["Reg_IDProofNumber"] = user.IDProofNumber;
                Session["Reg_Occupation"] = user.Occupation;
                Session["Reg_Role"] = user.Role;
                Session["Reg_OTP"] = otp;

                // 4. Send OTP Mail
                bool mailStatus = SendOTPEmail(user.Email, otp);
                if (!mailStatus)
                {
                    TempData["error"] = "Failed to send OTP. Try again.";
                    return View(user);
                }

                // 5. Redirect to OTP screen
                return RedirectToAction("VerifyOTP");
            }
            catch
            {
                TempData["error"] = "Something went wrong!";
                return View(user);
            }
        }


        public bool SendOTPEmail(string email, int otp)
        {
            try
            {
                MailMessage mail = new MailMessage();
                mail.To.Add(email);
                mail.From = new MailAddress("yourofficemail@gmail.com");
                mail.Subject = "StayEase Registration OTP";
                mail.Body = $"Your OTP for StayEase registration is: {otp}";

                SmtpClient smtp = new SmtpClient("smtp.gmail.com", 587);
                smtp.EnableSsl = true;
                smtp.Credentials = new NetworkCredential("yourofficemail@gmail.com", "YOUR_APP_PASSWORD");
                smtp.Send(mail);

                return true;
            }
            catch
            {
                return false;
            }
        }



        [HttpGet]
        public ActionResult VerifyOTP()
        {
            return View();
        }


        [HttpPost]
        public ActionResult VerifyOTP(string otp)
        {
            int sessionOTP = Convert.ToInt32(Session["Reg_OTP"]);

            if (otp != sessionOTP.ToString())
            {
                TempData["error"] = "Invalid OTP!";
                return View();
            }

            // OTP Correct â†’ Save User
            using (SqlConnection con = new SqlConnection(connString))
            {
                con.Open();

                SqlCommand cmd = new SqlCommand(@"
            INSERT INTO Users 
            (FullName, Email, Password, Gender, PhoneNo, Address, IDProofType, IDProofNumber, Occupation, Role)
            VALUES (@FullName, @Email, @Password, @Gender, @PhoneNo, @Address, @IDProofType, @IDProofNumber, @Occupation, @Role)", con);

                cmd.Parameters.AddWithValue("@FullName", Session["Reg_FullName"]);
                cmd.Parameters.AddWithValue("@Email", Session["Reg_Email"]);
                cmd.Parameters.AddWithValue("@Password", Session["Reg_Password"]);
                cmd.Parameters.AddWithValue("@Gender", Session["Reg_Gender"]);
                cmd.Parameters.AddWithValue("@PhoneNo", Session["Reg_PhoneNo"]);
                cmd.Parameters.AddWithValue("@Address", Session["Reg_Address"]);
                cmd.Parameters.AddWithValue("@IDProofType", Session["Reg_IDProofType"]);
                cmd.Parameters.AddWithValue("@IDProofNumber", Session["Reg_IDProofNumber"]);
                cmd.Parameters.AddWithValue("@Occupation", Session["Reg_Occupation"]);
                cmd.Parameters.AddWithValue("@Role", Session["Reg_Role"]);

                cmd.ExecuteNonQuery();
            }

            // Clear session after success
            Session.Clear();

            // Open login popup directly
            return Redirect("/Home/Index?openLogin=true");
        }


        public ActionResult CompleteRegister(string Email)
        {
            var user = TempData["UserData"] as UserModel;
            string Role = TempData["Role"].ToString();

            if (user == null)
            {
                TempData["error"] = "Session expired. Please register again.";
                return RedirectToAction("Register");
            }

            using (SqlConnection con = new SqlConnection(connString))
            {
                con.Open();

                string query = "";

                if (Role == "Admin")
                {
                    query = @"INSERT INTO Admins (FullName, Email, PhoneNo, PasswordHash, Role)
                      VALUES (@FullName, @Email, @PhoneNo, @PasswordHash, @Role)";
                }
                else
                {
                    query = @"INSERT INTO Users (FullName, Email, Gender, PhoneNo, Address, IDProofType, IDProofNumber, Occupation, PasswordHash, Role)
                      VALUES (@FullName, @Email, @Gender, @PhoneNo, @Address, @IDProofType, @IDProofNumber, @Occupation, @PasswordHash, @Role)";
                }

                SqlCommand cmd = new SqlCommand(query, con);
                cmd.Parameters.AddWithValue("@FullName", user.FullName);
                cmd.Parameters.AddWithValue("@Email", user.Email);
                cmd.Parameters.AddWithValue("@PhoneNo", user.PhoneNo);
                cmd.Parameters.AddWithValue("@PasswordHash", user.Password);
                cmd.Parameters.AddWithValue("@Role", Role);

                if (Role == "User")
                {
                    cmd.Parameters.AddWithValue("@Gender", user.Gender ?? "");
                    cmd.Parameters.AddWithValue("@Address", user.Address ?? "");
                    cmd.Parameters.AddWithValue("@IDProofType", user.IDProofType ?? "");
                    cmd.Parameters.AddWithValue("@IDProofNumber", user.IDProofNumber ?? "");
                    cmd.Parameters.AddWithValue("@Occupation", user.Occupation ?? "");
                }

                cmd.ExecuteNonQuery();
            }

            TempData["success"] = "Account created successfully!";
            TempData["OpenLoginPopup"] = "true";

            return RedirectToAction("Index", "Home", new { openLogin ="true"});
        }

        private void SendOTPEmail(string Email, string OTP)
        {
            try
            {
                MailMessage mail = new MailMessage();
                mail.To.Add(Email);
                mail.From = new MailAddress("stayeasepgbooking@gmail.com");
                mail.Subject = "StayEase Registration OTP";
                mail.Body = $"Your OTP for StayEase registration is: {OTP}";
                mail.IsBodyHtml = false;

                SmtpClient smtp = new SmtpClient("smtp.gmail.com", 587);
                smtp.Credentials = new NetworkCredential("stayeasepgbooking@gmail.com", "fstz tzcr yxbj bkbx");
                smtp.EnableSsl = true;

                smtp.Send(mail);
            }
            catch (Exception ex)
            {
                TempData["error"] = "Email error: " + ex.Message;
            }
        }


        // ===================== LOGIN ======================

        [HttpGet]
        public ActionResult Login()
        {
            return RedirectToAction("Index", "Home", new { openLogin = "true" });
        }

        [HttpPost]
        public ActionResult Login(string email, string password)
        {
            try
            {
                using (SqlConnection con = new SqlConnection(connString))
                {
                    con.Open();

                    // Check Admin
                    string adminQuery = @"SELECT AdminID AS ID, FullName, 'Admin' AS Role 
                                  FROM Admins 
                                  WHERE Email=@Email AND PasswordHash=@Password";

                    using (SqlCommand adminCmd = new SqlCommand(adminQuery, con))
                    {
                        adminCmd.Parameters.Add(new SqlParameter("@Email", SqlDbType.VarChar) { Value = email });
                        adminCmd.Parameters.Add(new SqlParameter("@Password", SqlDbType.VarChar) { Value = password });

                        using (SqlDataReader dr = adminCmd.ExecuteReader())
                        {
                            if (dr.Read())
                            {
                                Session["UserID"] = dr["ID"].ToString();
                                Session["AdminID"] = dr["ID"].ToString();
                                Session["FullName"] = dr["FullName"].ToString();
                                Session["Role"] = dr["Role"].ToString();

                                TempData["success"] = "Admin Login Successful!";
                                return RedirectToAction("Dashboard", "Admin");
                            }
                        }
                    }

                    // Check User
                    string userQuery = @"SELECT UserID AS ID, FullName, 'User' AS Role 
                                 FROM Users 
                                 WHERE Email=@Email AND PasswordHash=@Password";

                    using (SqlCommand userCmd = new SqlCommand(userQuery, con))
                    {
                        userCmd.Parameters.Add(new SqlParameter("@Email", SqlDbType.VarChar) { Value = email });
                        userCmd.Parameters.Add(new SqlParameter("@Password", SqlDbType.VarChar) { Value = password });

                        using (SqlDataReader dr = userCmd.ExecuteReader())
                        {
                            if (dr.Read())
                            {
                                Session["UserID"] = dr["ID"].ToString();
                                Session["FullName"] = dr["FullName"].ToString();
                                Session["Role"] = dr["Role"].ToString();

                                TempData["success"] = "Login Successful!";
                                return RedirectToAction("Index", "Home");
                            }
                        }
                    }

                    TempData["error"] = "Invalid Email or Password!";
                    return View();
                }
            }
            catch (Exception ex)
            {
                TempData["error"] = "Login error: " + ex.Message;
                return View();
            }
        }


        // ===================== LOGOUT ======================
        public ActionResult Logout()
        {
            Session.Clear();
            Session.Abandon();
            TempData["success"] = "Logged out successfully!";
            return RedirectToAction("Login");
        }

        [HttpGet]
        public ActionResult VerifyOTP(string Email)
        {
            ViewBag.Email = Email;
            return View();
        }

        [HttpGet]
        public ActionResult ResetPassword(string Email)
        {
            ViewBag.Email = Email;
            return View();
        }

        // ===================== ======================
        [HttpGet]
        public ActionResult ForgotPassword()
        {
            return View();
        }

        [HttpPost]
        public ActionResult SendOTP(string Email)
        {
            string otp = new Random().Next(100000, 999999).ToString();

            // STEP 1: CHECK EMAIL EXISTS
            using (SqlConnection con = new SqlConnection(connString))
            {
                SqlCommand cmd = new SqlCommand("SP_ForgotPassword", con);
                cmd.CommandType = CommandType.StoredProcedure;
                cmd.Parameters.AddWithValue("@Mode", "CheckEmail");
                cmd.Parameters.AddWithValue("@Email", Email);

                con.Open();
                int count = Convert.ToInt32(cmd.ExecuteScalar());
                if (count == 0)
                {
                    TempData["error"] = "Email not found!";
                    return View("ForgotPassword");
                }
            }

            // STEP 2: SAVE OTP
            using (SqlConnection con = new SqlConnection(connString))
            {
                SqlCommand cmd = new SqlCommand("SP_ForgotPassword", con);
                cmd.CommandType = CommandType.StoredProcedure;
                cmd.Parameters.AddWithValue("@Mode", "InsertOTP");
                cmd.Parameters.AddWithValue("@Email", Email);
                cmd.Parameters.AddWithValue("@OTP", otp);

                con.Open();
                cmd.ExecuteNonQuery();
            }

            // STEP 3: SEND OTP EMAIL
            SendOTPEmailForgotPassword(Email, otp);

            TempData["success"] = $"OTP Sent to {Email}";
            ViewBag.Email = Email;
            return View("VerifyOTP");
        }

        [HttpPost]
        public ActionResult VerifyOTP(string Email, string OTP)
        {
            using (SqlConnection con = new SqlConnection(connString))
            {
                SqlCommand cmd = new SqlCommand("SP_ForgotPassword", con);
                cmd.CommandType = CommandType.StoredProcedure;
                cmd.Parameters.AddWithValue("@Mode", "VerifyOTP");
                cmd.Parameters.AddWithValue("@Email", Email);
                cmd.Parameters.AddWithValue("@OTP", OTP);

                con.Open();
                int valid = Convert.ToInt32(cmd.ExecuteScalar());

                if (valid == 1)
                {
                    TempData["success"] = "OTP Verified!";
                    ViewBag.Email = Email;
                    return View("ResetPassword");
                }
                else
                {
                    TempData["error"] = "Invalid OTP!";
                    ViewBag.Email = Email;
                    return View("VerifyOTP");
                }
            }
        }

        [HttpPost]
        public ActionResult ResetPassword(string Email, string NewPassword, string ConfirmPassword)
        {
            if (NewPassword != ConfirmPassword)
            {
                TempData["error"] = "Password mismatch!";
                ViewBag.Email = Email;
                return View();
            }

            using (SqlConnection con = new SqlConnection(connString))
            {
                SqlCommand cmd = new SqlCommand("SP_ForgotPassword", con);
                cmd.CommandType = CommandType.StoredProcedure;
                cmd.Parameters.AddWithValue("@Mode", "UpdatePassword");
                cmd.Parameters.AddWithValue("@Email", Email);
                cmd.Parameters.AddWithValue("@NewPassword", NewPassword);

                con.Open();
                cmd.ExecuteNonQuery();
            }

            TempData["success"] = "Password Updated Successfully!";
            return RedirectToAction("Login");
        }

        // ===================== EMAIL FUNCTION ======================
        private void SendOTPEmailForgotPassword(string Email, string OTP)
        {
            try
            {
                MailMessage mail = new MailMessage();
                mail.To.Add(Email);
                mail.From = new MailAddress("stayeasepgbooking@gmail.com"); // Replace with your email
                mail.Subject = "StayEase - Password Reset OTP";
                mail.Body = "Your OTP is: " + OTP;
                mail.IsBodyHtml = false;

                SmtpClient smtp = new SmtpClient("smtp.gmail.com", 587);
                smtp.Credentials = new NetworkCredential("stayeasepgbooking@gmail.com", "fstz tzcr yxbj bkbx"); // Use Gmail App Password
                smtp.EnableSsl = true;
                smtp.Send(mail);
            }
            catch (Exception ex)
            {
                TempData["error"] = "Error sending email: " + ex.Message;
            }
        }
    }
}



[HttpPost]
public ActionResult Login(string email, string password)
{
    bool hasError = false;

    if (string.IsNullOrEmpty(email))
    {
        ModelState.AddModelError("email", "Enter email or username");
        hasError = true;
    }
    if (string.IsNullOrEmpty(password))
    {
        ModelState.AddModelError("password", "Enter password");
        hasError = true;
    }

    if (hasError)
    {
        TempData["OpenLoginPopup"] = true;
        return View("~/Views/Home/Index.cshtml");
    }

    // -------------------------
    // Your original login logic
    // -------------------------

    return RedirectToAction("Index", "Home");
}




<div class="form-group">
    <label class="popup-label">Email or Username</label>
    @Html.TextBox("email", null, new { @class = "popup-input", placeholder = "Enter your email" })

    @Html.ValidationMessage("email", "", new { @class = "text-danger", style="font-size:13px;margin-top:3px;" })
</div>


<div class="form-group" style="margin-top:15px;">
    <label class="popup-label">Password</label>
    @Html.Password("password", null, new { @class = "popup-input", placeholder = "Enter your password" })

    @Html.ValidationMessage("password", "", new { @class = "text-danger", style="font-size:13px;margin-top:3px;" })
</div>





</head>

<body>


    <!-- NAVBAR -->
    <div class="navbar navbar-inverse navbar-fixed-top navbar-custom">
        <div class="container">
            <div class="navbar-header">

                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                @Html.ActionLink("Stay-Ease", "Index", "Home", null, new { @class = "navbar-brand" })
            </div>

            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li>@Html.ActionLink("Home", "Index", "Home")</li>
                    <li>@Html.ActionLink("About", "About", "Home")</li>
                    <li>@Html.ActionLink("Contact", "Contact", "Home")</li>

                    @if (!string.IsNullOrEmpty(userRole) && userRole == "Admin")
                    {
                        <li class="dashboard-link">
                            @Html.ActionLink("Admin Dashboard", "Dashboard", "Admin")
                        </li>
                    }
                </ul>

                <div class="header-buttons navbar-right">
                    @if (Session["FullName"] != null)

                    {
                        <span class="welcome-text">Welcome, @Session["FullName"]!</span>
                        <button class="logout-btn" onclick="window.location.href='@Url.Action("Logout","Account")'">Logout</button>
                    }
                    else if (current == "index" ||current == "about" ||current == "contact")
                    {
                        <button id="openLoginPopupButton" class="login-btn" data-toggle="modal" data-target="#loginModal">Login</button>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="container body-content" style="margin-top:100px;">
        @RenderBody()
    </div>

    <!-- LOGIN POPUP -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <h2 class="popup-title">Login</h2>

                @using (Html.BeginForm("Login", "Account", FormMethod.Post))

                {

                    <div class="form-group">
                        <label class="popup-label">Email or Username</label>
                        @Html.TextBox("email", null, new { @class = "popup-input", placeholder = "Enter your email" })

                        @Html.ValidationMessage("email", "", new { @class = "text-danger", style = "font-size:13px;margin-top:3px;" })
                    </div>




                    <div class="form-group" style="margin-top:15px;">
                        <label class="popup-label">Password</label>
                        @Html.Password("password", null, new { @class = "popup-input", placeholder = "Enter your password" })

                        @Html.ValidationMessage("password", "", new { @class = "text-danger", style = "font-size:13px;margin-top:3px;" })
                    </div>



                    <button type="submit" class="popup-btn">Login</button>



                    <div class="popup-links text-center mt-3">
                        <a href="/Account/ForgotPassword">Forgot Password?</a><br />
                        <a href="/Account/Register">New User? Register Here</a>
                    </div>

                }
            </div>
        </div>
    </div>

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")

    <!-- AUTO-OPEN LOGIN POPUP -->
    <script>
    $(document).ready(function () {

        // open popup when URL has ?openLogin=true
        const urlParam = new URL(window.location.href).searchParams.get("openLogin");
        if (urlParam === "true") {
            $("#loginModal").modal("show");
        }

        // open popup when TempData["OpenLoginPopup"] is set
        @if (TempData["OpenLoginPopup"] != null)
        {
            <text>
                $("#loginModal").modal("show");
            </text>
        }
    });
    </script>


    @RenderSection("scripts", required: false)
</body>
</html>








new layout

@{
    string current = ViewContext.RouteData.Values["Action"].ToString().ToLower();
    string currentController = ViewContext.RouteData.Values["Controller"].ToString().ToLower();
    string userRole = Session["Role"] as string;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - Stay-Ease</title>

    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
</head>

<body>

    <!-- NAVBAR -->
    <div class="navbar navbar-inverse navbar-fixed-top navbar-custom">
        <div class="container">
            <div class="navbar-header">

                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                @Html.ActionLink("Stay-Ease", "Index", "Home", null, new { @class = "navbar-brand" })
            </div>

            <div class="navbar-collapse collapse">

                <ul class="nav navbar-nav">
                    <li>@Html.ActionLink("Home", "Index", "Home")</li>
                    <li>@Html.ActionLink("About", "About", "Home")</li>
                    <li>@Html.ActionLink("Contact", "Contact", "Home")</li>

                    @if (userRole == "Admin")
                    {
                        <li class="dashboard-link">
                            @Html.ActionLink("Admin Dashboard", "Dashboard", "Admin")
                        </li>
                    }
                </ul>

                <div class="header-buttons navbar-right">

                    @if (Session["FullName"] != null)
                    {
                        <span class="welcome-text">Welcome, @Session["FullName"]!</span>
                        <button class="logout-btn" onclick="window.location.href='@Url.Action("Logout","Account")'">Logout</button>
                    }
                    else
                    {
                        @* Show Login Button ONLY on Home / About / Contact *@
                        if (currentController == "home")
                        {
                            <button id="openLoginPopupButton" class="login-btn" data-toggle="modal" data-target="#loginModal">Login</button>
                        }
                    }
                </div>

            </div>
        </div>
    </div>

    <div class="container body-content" style="margin-top:100px;">
        @RenderBody()
    </div>


    <!-- LOGIN POPUP -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">

                <h2 class="popup-title">Login</h2>

                <form id="ajaxLoginForm">

                    <div class="form-group">
                        <label class="popup-label">Email or Username</label>
                        <input type="text" name="email" class="popup-input" placeholder="Enter your email" />
                        <span id="emailError" class="text-danger" style="font-size:13px;"></span>
                    </div>

                    <div class="form-group" style="margin-top:15px;">
                        <label class="popup-label">Password</label>
                        <input type="password" name="password" class="popup-input" placeholder="Enter your password" />
                        <span id="passwordError" class="text-danger" style="font-size:13px;"></span>
                    </div>

                    <button type="submit" class="popup-btn">Login</button>

                    <span id="loginError" class="text-danger text-center" style="display:block;margin-top:10px;"></span>

                    <div class="popup-links text-center mt-3">
                        <a href="/Account/ForgotPassword">Forgot Password?</a><br />
                        <a href="/Account/Register">New User? Register Here</a>
                    </div>

                </form>

            </div>
        </div>
    </div>


    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")


    <!-- AJAX LOGIN WITHOUT REFRESH -->
    <script>
        $("#ajaxLoginForm").submit(function (e) {
            e.preventDefault();

            $("#emailError").text("");
            $("#passwordError").text("");
            $("#loginError").text("");

            var email = $("input[name='email']").val();
            var password = $("input[name='password']").val();

            if (!email) {
                $("#emailError").text("Enter email or username");
                return;
            }

            if (!password) {
                $("#passwordError").text("Enter password");
                return;
            }

            $.ajax({
                url: "/Account/Login",
                type: "POST",
                data: { email: email, password: password },
                success: function (response) {
                    if (response.success) {
                        location.reload();
                    } else {
                        $("#loginError").text(response.message);
                        $("#loginModal").modal("show");
                    }
                }
            });

        });
    </script>

    <!-- AUTO OPEN LOGIN (For Register button redirect) -->
    <script>
        $(document).ready(function () {

            const urlParam = new URL(window.location.href).searchParams.get("openLogin");

            if (urlParam === "true") {
                $("#loginModal").modal("show");
            }

        });
    </script>

    @RenderSection("scripts", required: false)

</body>
</html>
